From 96bf7e967cbc798086c39115c61fcefec88eb58a Mon Sep 17 00:00:00 2001
From: Pierre-Yves <pyu@riseup.net>
Date: Wed, 27 Sep 2017 22:17:22 +0200
Subject: [PATCH] libmp4ff shared lib

Signed-off-by: Pierre-Yves <pyu@riseup.net>
---
 common/mp4ff/Makefile.am | 9 +++++----
 frontend/Makefile.am     | 5 +++--
 2 files changed, 8 insertions(+), 6 deletions(-)

diff --git a/common/mp4ff/Makefile.am b/common/mp4ff/Makefile.am
index 23d7499..26db70d 100644
--- a/common/mp4ff/Makefile.am
+++ b/common/mp4ff/Makefile.am
@@ -1,7 +1,8 @@
-noinst_LIBRARIES = libmp4ff.a
-noinst_HEADERS = mp4ff.h mp4ffint.h
+lib_LTLIBRARIES = libmp4ff.la
+include_HEADERS = mp4ff.h mp4ffint.h
 
-libmp4ff_a_CFLAGS = -DUSE_TAGGING=1
+AM_CFLAGS = -DUSE_TAGGING=1
 
-libmp4ff_a_SOURCES = mp4ff.c mp4atom.c mp4meta.c mp4sample.c mp4util.c \
+libmp4ff_la_LDFLAGS = -version-info 0:0:0
+libmp4ff_la_SOURCES = mp4ff.c mp4atom.c mp4meta.c mp4sample.c mp4util.c \
 		     mp4tagupdate.c mp4ff.h mp4ffint.h
diff --git a/frontend/Makefile.am b/frontend/Makefile.am
index e1bec91..d9e15be 100644
--- a/frontend/Makefile.am
+++ b/frontend/Makefile.am
@@ -1,9 +1,10 @@
 bin_PROGRAMS = faad
 dist_man1_MANS = faad.man
 
-AM_CPPFLAGS = -I$(top_srcdir)/include
+AM_CPPFLAGS = -I$(top_srcdir)/include -I$(top_srcdir)/common/mp4ff
 
-faad_LDADD = $(top_builddir)/libfaad/libfaad.la
+faad_LDADD = $(top_builddir)/libfaad/libfaad.la \
+			$(top_builddir)/common/mp4ff/libmp4ff.la
 
 faad_SOURCES = main.c audio.c audio.h mp4read.c mp4read.h
 
-- 
2.14.2

